<link href="//cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css" rel="stylesheet">
<script defer src="//cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<div class="bd-callout bd-callout-primary bg-light alert alert-dismissible fade show shadow-sm" style="top:-6px">
    <p><i class="bi bi-person-lines-fill pr-2" style="padding-right:8px;"></i> {{ 'accounts-note'|text }}
    <button type="button" class="btn-close" style="font-size:0.7rem" data-bs-dismiss="alert" aria-label="{{ 'close'|text }}"></button>
    </p>
</div>
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-4">
    <h3 class="text-primary" style="padding-right:10px"><i class="bi bi-people-fill"></i>  {{ 'accounts'|text }}</h3>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            {% if user.can('system_forgot_index') %}
            <a class="btn btn-outline-dark shadow-sm" data-bs-target="#dashboard-modal" data-bs-toggle="modal"
               href="{{ 'crud'|link({'action':'index'}) }}?logger=account&table=forgot&controller=Velociraptor\Account\AccountController">
                {{ 'password-reset-request'|text }}
            </a>
            {% endif %}
            {% if user.can('system_newbie_index') %}
            <a class="btn btn-outline-primary shadow-sm" data-bs-target="#dashboard-modal" data-bs-toggle="modal"
               href="{{ 'crud'|link({'action':'index'}) }}?logger=account&table=newbie&controller=Velociraptor\Account\AccountController">
                {{ 'request-new-account'|text }}
            </a>
            {% endif %}
            {% if user.can('system_account_insert') %}
            <a class="btn btn-outline-success shadow-sm"
               href="{{ 'crud'|link({'action':'insert'}) }}?logger=account&table=account&controller=Velociraptor\Account\AccountController">
                <i class="bi bi-person-plus-fill" style="margin-right:4px;"></i> {{ 'add-new-account'|text }}
            </a>
            {% endif %}
        </div>
    </div>
</div>
<table class="table table-striped table-hover" id="account">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">{{ 'photo'|text }}</th>
            <th scope="col">{{ 'name'|text }}</th>
            <th scope="col">{{ 'login'|text }}</th>
            <th scope="col">{{ 'organization'|text }}</th>
            <th scope="col">{{ 'role2'|text }}</th>
            <th scope="col">{{ 'status'|text }}</th>
            <th scope="col" style="width:130px">{{ 'action'|text }}</th>
        </tr>
    </thead>
    <tbody>
    {% for account in accounts %}
        <tr id="account_{{ account['id'] }}">
            <th scope="row">{{ account['id'] }}</th>
            <td><img alt="{{ account['first_name'] ~ ' ' ~ account['last_name'] }}" src="{{ account['photo']|default('https://cdn.jsdelivr.net/gh/codesaur-php/HTML-Assets/dist/images/no-account.gif') }}" width="60px"></td>
            <td>
                {{ account['first_name'] ~ ' ' ~ account['last_name'] }}
                {% if account['phone'] is not null and account['phone'] is not empty %}<br/><a class="badge bg-info fw-normal text-decoration-none mt-1" href="tel:{{ account['phone'] }}"><i class="bi bi-telephone-fill"></i> {{ account['phone'] }}</a>{% endif %}
            </td>
            <td>
                {{ account['username'] }}
                <br/><a class="badge bg-success fw-normal text-decoration-none mt-1" href="mailto:{{ account['email'] }}"><i class="bi bi-envelope"></i> {{ account['email'] }}</a>
            </td>
            <td>
                <a href="{{ 'account-organization-set'|link({'id':account['id']}) }}"
                   class="btn btn-dark btn-sm shadow-sm" data-bs-target="#dashboard-modal" data-bs-toggle="modal"><i class="bi bi-bank"></i>
                </a>
            {% for org in account['organizations'] %}
                <a href="{{ 'crud'|link({'action':'retrieve'}) }}?logger=organization&controller=Velociraptor\Organization\OrganizationController&id={{ organizations[org]['id'] }}"
                   class="badge bg-{{ organizations[org]['alias'] == 'system' ? 'primary' : 'warning' }} fw-normal text-decoration-none" data-bs-target="#dashboard-modal" data-bs-toggle="modal">
                    {{ organizations[org]['name'] }}
                </a>
            {% endfor %}
            </td>
            <td>
                <a href="{{ 'crud'|link({'action':'update'}) }}?logger=rbac&controller=Velociraptor\RBAC\RBACController&thing=user_role&id={{ account['id'] }}"
                   class="btn btn-danger btn-sm shadow-sm" data-bs-target="#dashboard-modal" data-bs-toggle="modal"><i class="bi bi-shield-fill-check"></i>
                </a>
            {% for role in account['roles'] %}
                <span class="badge bg-{{ role == 'system_coder' ? 'primary' : 'warning' }} shadow-sm">{{ role }}</span>
            {% endfor %}
            </td>
            <td>
                <span class="badge bg-{{ account['status'] ? 'dark' : 'secondary' }}">{{ statuses[account['status']]['title'][localization.code] ?? account['status'] }}</span>
            </td>
            <td>
                {% if user.can('system_account_retrieve') %}
                <a href="{{ 'crud'|link({'action':'retrieve'}) }}?logger=account&controller=Velociraptor\Account\AccountController&id={{ account['id'] }}" class="btn btn-sm btn-info shadow-sm"><i class="bi bi-eye"></i></a>
                {% endif %}
                {% if account['id'] == user.account('id') or (account['id'] != 1 and user.can('system_account_update')) %}
                <a href="{{ 'crud'|link({'action':'update'}) }}?logger=account&controller=Velociraptor\Account\AccountController&id={{ account['id'] }}" class="btn btn-sm btn-primary shadow-sm"><i class="bi bi-pencil-square"></i></a>
                {% endif %}
                {% if account['id'] != user.account('id') and account['id'] != 1 and user.can('system_account_delete') %}
                <a href="{{ account['id'] }}" on-success="$('#account_{{ account['id'] }}').remove();" class="delete btn btn-sm btn-danger shadow-sm"><i class="bi bi-trash"></i></a>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
    <tfoot></tfoot>
</table>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        $('table#account').DataTable({
            lengthMenu: [[5, 10, 30, -1], [5, 10, 30, "{{ 'all1'|text }}"]],
            responsive: true, bStateSave: true, pagingType: 'full_numbers', pageLength: 10, order: [[0, 'asc']]
            {% if localization.code == 'mn' %}, language: {url: "https://cdn.jsdelivr.net/gh/codesaur-php/HTML-Assets/dist/datatables/mongolian.json"}{% endif %}
        });
    });
</script>
