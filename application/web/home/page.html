<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css">
<script defer src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>

<div class="container">
    <div class="row">
        <div class="text-center mt-4 mb-3 pb-2 border-bottom">
            <h2>{{ title }}</h2>
        </div>
    </div>
</div>

<style>
    .page-article > p {
        text-align: justify;
        margin: 0;
        color: black;
    }
    .page-article > dl,
    .page-article > ol,
    .page-article > ul {
        margin-bottom: 0;
    }
</style>

<article class="container page-article">

    {% if photo is not null and photo is not empty %}
        <img class="img-fluid mb-3 rounded shadow-sm"
             file-data-fancybox
             src="{{ photo }}"
             alt="{{ title|e }}">
    {% endif %}

    {{ content }}

    {% if files is defined and files is not empty %}
    <div class="mt-4">
        <hr>
        <h5><i class="bi bi-paperclip"></i> {{ code == 'mn' ? 'Хавсралт файлууд' : 'Attachments' }}</h5>
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th style="width:50px">#</th>
                    <th>{{ code == 'mn' ? 'Файл' : 'File' }}</th>
                    <th style="width:120px">{{ code == 'mn' ? 'Хэмжээ' : 'Size' }}</th>
                    <th style="width:100px">{{ code == 'mn' ? 'Төрөл' : 'Type' }}</th>
                </tr>
            </thead>
            <tbody>
                {% for file in files %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>
                        <a href="{{ file['path'] }}" target="_blank" class="text-decoration-none">
                            {% if file['type'] == 'image' %}
                                <i class="bi bi-file-image text-success"></i>
                            {% elseif file['type'] == 'video' %}
                                <i class="bi bi-file-play text-danger"></i>
                            {% elseif file['type'] == 'audio' %}
                                <i class="bi bi-file-music text-info"></i>
                            {% elseif file['mime_content_type'] == 'application/pdf' %}
                                <i class="bi bi-file-pdf text-danger"></i>
                            {% elseif file['mime_content_type'] starts with 'application/vnd.ms-excel' or file['mime_content_type'] starts with 'application/vnd.openxmlformats-officedocument.spreadsheet' %}
                                <i class="bi bi-file-excel text-success"></i>
                            {% elseif file['mime_content_type'] starts with 'application/msword' or file['mime_content_type'] starts with 'application/vnd.openxmlformats-officedocument.wordprocessing' %}
                                <i class="bi bi-file-word text-primary"></i>
                            {% elseif file['mime_content_type'] starts with 'application/zip' or file['mime_content_type'] starts with 'application/x-rar' or file['mime_content_type'] starts with 'application/x-7z' %}
                                <i class="bi bi-file-zip text-warning"></i>
                            {% else %}
                                <i class="bi bi-file-earmark"></i>
                            {% endif %}
                            {{ file['path']|basename }}
                        </a>
                        {% if file['description'] is not empty %}
                            <small class="text-muted d-block">{{ file['description'] }}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if file['size'] < 1024 %}
                            {{ file['size'] }} B
                        {% elseif file['size'] < 1048576 %}
                            {{ (file['size'] / 1024)|round(1) }} KB
                        {% else %}
                            {{ (file['size'] / 1048576)|round(2) }} MB
                        {% endif %}
                    </td>
                    <td><span class="badge bg-secondary">{{ file['type'] }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</article>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
        Fancybox.bind('[file-data-fancybox]', {
            groupAll: true
        });
    });
</script>
